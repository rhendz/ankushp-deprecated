(function(){var GOL={columns:0,rows:0,maxCells:10000,waitTime:0,generation:0,running:!1,autoplay:!0,clear:{schedule:!1},times:{algorithm:0,gui:0},element:{generation:null,steptime:null,livecells:null,hint:null},grid:{current:0,schemes:[{color:'#F3F3F3'},{color:'#FFFFFF'},{color:'#666666'},{color:''}]},zoom:{current:0,schedule:!1,schemes:[{columns:180,rows:86,cellSize:8},{columns:300,rows:144,cellSize:2},{columns:450,rows:216,cellSize:1}]},colors:{current:0,schedule:!1,schemes:[{dead:'#FFFFFF',alive:['#FF8200']},{dead:'#FFFFFF',alive:['#FF0000','#FF7F00','#FFFF00','#008000 ','#0000FF','#4B0082','#EE82EE']},{dead:'#FFFFFF',alive:['#000000']}]},init:function(){try{window.addEventListener("resize",function(){GOL.cleanUp();GOL.init()});this.listLife.init();this.loadConfig();this.loadState();this.canvas.init();this.prepare()}catch(e){alert("Error: "+e)}},loadConfig:function(){var colors,grid,zoom;this.autoplay=GOL.autoplay;colors=parseInt(1);if(isNaN(colors)||colors<1||colors>GOL.colors.schemes.length){colors=1}
grid=parseInt(4);if(isNaN(grid)||grid<1||grid>GOL.grid.schemes.length){grid=1}
zoom=parseInt(1);if(isNaN(zoom)||zoom<1||zoom>GOL.zoom.schemes.length){zoom=1}
this.colors.current=colors-1;this.grid.current=grid-1;this.zoom.current=zoom-1;var canvas=document.getElementById('gol');GOL.columns=canvas.scrollWidth;GOL.rows=canvas.scrollHeight;var cellSize=1;while((GOL.columns*GOL.rows)/cellSize>GOL.maxCells){GOL.columns/=2;GOL.rows/=2;cellSize*=2}
this.zoom.schemes[this.zoom.current].rows=GOL.rows;this.zoom.schemes[this.zoom.current].columns=GOL.columns;this.zoom.schemes[this.zoom.current].cellSize=cellSize;this.rows=this.zoom.schemes[this.zoom.current].rows;this.columns=this.zoom.schemes[this.zoom.current].columns},loadState:function(){this.randomState()},randomState:function(){var i,liveCells=(this.rows*this.columns)*0.12;for(i=0;i<liveCells;i++){this.listLife.addCell(this.helpers.random(0,this.columns-1),this.helpers.random(0,this.rows-1),this.listLife.actualState)}
this.listLife.nextGeneration()},cleanUp:function(){this.listLife.init();this.prepare()},prepare:function(){this.generation=this.times.algorithm=this.times.gui=0;this.mouseDown=this.clear.schedule=!1;this.canvas.clearWorld();this.canvas.drawWorld();if(this.autoplay){this.autoplay=!1;this.handlers.buttons.run()}},nextStep:function(){var i,x,y,r,liveCellNumber,algorithmTime,guiTime;algorithmTime=(new Date());liveCellNumber=GOL.listLife.nextGeneration();algorithmTime=(new Date())-algorithmTime;guiTime=(new Date());for(i=0;i<GOL.listLife.redrawList.length;i++){x=GOL.listLife.redrawList[i][0];y=GOL.listLife.redrawList[i][1];if(GOL.listLife.redrawList[i][2]===1){GOL.canvas.changeCelltoAlive(x,y)}else if(GOL.listLife.redrawList[i][2]===2){GOL.canvas.keepCellAlive(x,y)}else{GOL.canvas.changeCelltoDead(x,y)}}
guiTime=(new Date())-guiTime;if(GOL.grid.schedule){GOL.grid.schedule=!1;GOL.canvas.drawWorld()}
if(GOL.colors.schedule){GOL.colors.schedule=!1;GOL.canvas.drawWorld()}
GOL.generation++;r=1.0/GOL.generation;GOL.times.algorithm=(GOL.times.algorithm*(1-r))+(algorithmTime*r);GOL.times.gui=(GOL.times.gui*(1-r))+(guiTime*r);if(GOL.running){function animateFrame(){window.requestAnimationFrame(GOL.nextStep)}
if(GOL.waitTime>0)setTimeout(function(){animateFrame()},GOL.waitTime);else animateFrame()}else{if(GOL.clear.schedule){GOL.cleanUp()}}},handlers:{lastX:0,lastY:0,canvasMouseMove:function(event){var position=GOL.helpers.mousePosition(event);if((position[0]!==GOL.handlers.lastX)||(position[1]!==GOL.handlers.lastY)){GOL.canvas.switchCell(position[0],position[1]);GOL.handlers.lastX=position[0];GOL.handlers.lastY=position[1]}},buttons:{run:function(){GOL.running=!GOL.running;if(GOL.running){GOL.nextStep()}},step:function(){if(!GOL.running){GOL.nextStep()}},clear:function(){if(GOL.running){GOL.clear.schedule=!0;GOL.running=!1}else{GOL.cleanUp()}},colors:function(){GOL.colors.current=(GOL.colors.current+1)%GOL.colors.schemes.length;if(GOL.running){GOL.colors.schedule=!0}else{GOL.canvas.drawWorld()}},grid:function(){GOL.grid.current=(GOL.grid.current+1)%GOL.grid.schemes.length;if(GOL.running){GOL.grid.schedule=!0}else{GOL.canvas.drawWorld()}}}},canvas:{context:null,width:null,height:null,age:null,cellSize:null,cellSpace:null,init:function(){this.canvas=document.getElementById('gol');this.context=this.canvas.getContext('2d');this.cellSize=GOL.zoom.schemes[GOL.zoom.current].cellSize;this.cellSpace=1;GOL.helpers.registerEvent(document,'mousemove',GOL.handlers.canvasMouseMove,!1);this.clearWorld()},clearWorld:function(){var i,j;this.age=[];for(i=0;i<GOL.columns;i++){this.age[i]=[];for(j=0;j<GOL.rows;j++){this.age[i][j]=0}}},drawWorld:function(){var i,j;if(GOL.grid.schemes[GOL.grid.current].color===''){this.setNoGridOn();this.width=this.height=0}else{this.setNoGridOff();this.width=this.height=1}
this.width=this.width+(this.cellSpace*GOL.columns)+(this.cellSize*GOL.columns);this.canvas.setAttribute('width',this.canvas.scrollWidth);this.height=this.height+(this.cellSpace*GOL.rows)+(this.cellSize*GOL.rows);this.canvas.setAttribute('height',this.canvas.scrollHeight);for(i=0;i<GOL.columns;i++){for(j=0;j<GOL.rows;j++){if(GOL.listLife.isAlive(i,j)){this.drawCell(i,j,!0)}else{this.drawCell(i,j,!1)}}}},setNoGridOn:function(){this.cellSize=GOL.zoom.schemes[GOL.zoom.current].cellSize+1;this.cellSpace=0},setNoGridOff:function(){this.cellSize=GOL.zoom.schemes[GOL.zoom.current].cellSize;this.cellSpace=1},drawCell:function(i,j,alive){if(alive){if(this.age[i][j]>-1){this.context.fillStyle=GOL.colors.schemes[GOL.colors.current].alive[this.age[i][j]%GOL.colors.schemes[GOL.colors.current].alive.length];this.context.fillRect(this.cellSpace+(this.cellSpace*i)+(this.cellSize*i),this.cellSpace+(this.cellSpace*j)+(this.cellSize*j),this.cellSize,this.cellSize)}}else this.context.clearRect(this.cellSpace+(this.cellSpace*i)+(this.cellSize*i),this.cellSpace+(this.cellSpace*j)+(this.cellSize*j),this.cellSize,this.cellSize)},switchCell:function(i,j){if(GOL.listLife.isAlive(i,j)){this.changeCelltoDead(i,j);GOL.listLife.removeCell(i,j,GOL.listLife.actualState)}else{this.changeCelltoAlive(i,j);GOL.listLife.addCell(i,j,GOL.listLife.actualState)}},keepCellAlive:function(i,j){if(i>=0&&i<GOL.columns&&j>=0&&j<GOL.rows){this.age[i][j]++;this.drawCell(i,j,!0)}},changeCelltoAlive:function(i,j){if(i>=0&&i<GOL.columns&&j>=0&&j<GOL.rows){this.age[i][j]=1;this.drawCell(i,j,!0)}},changeCelltoDead:function(i,j){if(i>=0&&i<GOL.columns&&j>=0&&j<GOL.rows){this.drawCell(i,j,!1)}}},listLife:{actualState:[],redrawList:[],init:function(){this.actualState=[]},nextGeneration:function(){var x,y,i,j,m,n,key,t1,t2,alive=0,neighbours,deadNeighbours,allDeadNeighbours={},newState=[];this.redrawList=[];for(i=0;i<this.actualState.length;i++){this.topPointer=1;this.bottomPointer=1;for(j=1;j<this.actualState[i].length;j++){x=this.actualState[i][j];y=this.actualState[i][0];deadNeighbours=[[x-1,y-1,1],[x,y-1,1],[x+1,y-1,1],[x-1,y,1],[x+1,y,1],[x-1,y+1,1],[x,y+1,1],[x+1,y+1,1]];neighbours=this.getNeighboursFromAlive(x,y,i,deadNeighbours);for(m=0;m<8;m++){if(deadNeighbours[m]!==undefined){key=deadNeighbours[m][0]+','+deadNeighbours[m][1];if(allDeadNeighbours[key]===undefined){allDeadNeighbours[key]=1}else{allDeadNeighbours[key]++}}}
if(!(neighbours===0||neighbours===1||neighbours>3)){this.addCell(x,y,newState);alive++;this.redrawList.push([x,y,2])}else{this.redrawList.push([x,y,0])}}}
for(key in allDeadNeighbours){if(allDeadNeighbours[key]===3){key=key.split(',');t1=parseInt(key[0],10);t2=parseInt(key[1],10);this.addCell(t1,t2,newState);alive++;this.redrawList.push([t1,t2,1])}}
this.actualState=newState;return alive},topPointer:1,middlePointer:1,bottomPointer:1,getNeighboursFromAlive:function(x,y,i,possibleNeighboursList){var neighbours=0,k;if(this.actualState[i-1]!==undefined){if(this.actualState[i-1][0]===(y-1)){for(k=this.topPointer;k<this.actualState[i-1].length;k++){if(this.actualState[i-1][k]>=(x-1)){if(this.actualState[i-1][k]===(x-1)){possibleNeighboursList[0]=undefined;this.topPointer=k+1;neighbours++}
if(this.actualState[i-1][k]===x){possibleNeighboursList[1]=undefined;this.topPointer=k;neighbours++}
if(this.actualState[i-1][k]===(x+1)){possibleNeighboursList[2]=undefined;if(k==1){this.topPointer=1}else{this.topPointer=k-1}
neighbours++}
if(this.actualState[i-1][k]>(x+1)){break}}}}}
for(k=1;k<this.actualState[i].length;k++){if(this.actualState[i][k]>=(x-1)){if(this.actualState[i][k]===(x-1)){possibleNeighboursList[3]=undefined;neighbours++}
if(this.actualState[i][k]===(x+1)){possibleNeighboursList[4]=undefined;neighbours++}
if(this.actualState[i][k]>(x+1)){break}}}
if(this.actualState[i+1]!==undefined){if(this.actualState[i+1][0]===(y+1)){for(k=this.bottomPointer;k<this.actualState[i+1].length;k++){if(this.actualState[i+1][k]>=(x-1)){if(this.actualState[i+1][k]===(x-1)){possibleNeighboursList[5]=undefined;this.bottomPointer=k+1;neighbours++}
if(this.actualState[i+1][k]===x){possibleNeighboursList[6]=undefined;this.bottomPointer=k;neighbours++}
if(this.actualState[i+1][k]===(x+1)){possibleNeighboursList[7]=undefined;if(k==1){this.bottomPointer=1}else{this.bottomPointer=k-1}
neighbours++}
if(this.actualState[i+1][k]>(x+1)){break}}}}}
return neighbours},isAlive:function(x,y){var i,j;for(i=0;i<this.actualState.length;i++){if(this.actualState[i][0]===y){for(j=1;j<this.actualState[i].length;j++){if(this.actualState[i][j]===x){return!0}}}}
return!1},removeCell:function(x,y,state){var i,j;for(i=0;i<state.length;i++){if(state[i][0]===y){if(state[i].length===2){state.splice(i,1)}else{for(j=1;j<state[i].length;j++){if(state[i][j]===x){state[i].splice(j,1)}}}}}},addCell:function(x,y,state){if(state.length===0){state.push([y,x]);return}
var k,n,m,tempRow,newState=[],added;if(y<state[0][0]){newState=[[y,x]];for(k=0;k<state.length;k++){newState[k+1]=state[k]}
for(k=0;k<newState.length;k++){state[k]=newState[k]}
return}else if(y>state[state.length-1][0]){state[state.length]=[y,x];return}else{for(n=0;n<state.length;n++){if(state[n][0]===y){tempRow=[];added=!1;for(m=1;m<state[n].length;m++){if((!added)&&(x<state[n][m])){tempRow.push(x);added=!added}
tempRow.push(state[n][m])}
tempRow.unshift(y);if(!added){tempRow.push(x)}
state[n]=tempRow;return}
if(y<state[n][0]){newState=[];for(k=0;k<state.length;k++){if(k===n){newState[k]=[y,x];newState[k+1]=state[k]}else if(k<n){newState[k]=state[k]}else if(k>n){newState[k+1]=state[k]}}
for(k=0;k<newState.length;k++){state[k]=newState[k]}
return}}}}},helpers:{urlParameters:null,random:function(min,max){return min<=max?min+Math.round(Math.random()*(max-min)):null},registerEvent:function(element,event,handler,capture){if(/msie/i.test(navigator.userAgent)){element.attachEvent('on'+event,handler)}else{element.addEventListener(event,handler,capture)}},mousePosition:function(e){var event,x,y,domObject,posx=0,posy=0,top=0,left=0,cellSize=GOL.zoom.schemes[GOL.zoom.current].cellSize+1;event=e;if(!event){event=window.event}
if(event.pageX||event.pageY){posx=event.pageX;posy=event.pageY}else if(event.clientX||event.clientY){posx=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=event.clientY+document.body.scrollTop+document.documentElement.scrollTop}
domObject=event.target||event.srcElement;while(domObject.offsetParent){left+=domObject.offsetLeft;top+=domObject.offsetTop;domObject=domObject.offsetParent}
domObject.pageTop=top;domObject.pageLeft=left;x=Math.ceil(((posx-domObject.pageLeft)/cellSize)-1);y=Math.ceil(((posy-domObject.pageTop)/cellSize)-1);return[x,y]}}};GOL.helpers.registerEvent(window,'load',function(){GOL.init()},!1)}())
